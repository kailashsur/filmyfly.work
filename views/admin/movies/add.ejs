<%- include('../../partials/admin_header', { title: title }) %>

<div class="container">
    <div class="admin-form-page">
        <div class="page-header">
            <h1>Add Movie</h1>
            <div class="header-actions">
                <a href="/admin" class="btn btn-secondary">Go to Dashboard</a>
                <a href="/admin/movies" class="btn btn-secondary">Back to List</a>
            </div>
        </div>

        <% if (error) { %>
            <div class="alert alert-error">
                <%= error %>
            </div>
        <% } %>

        <form method="POST" action="/admin/movies/add" class="movie-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="title">Title *</label>
                    <input type="text" id="title" name="title" value="<%= movie?.title || '' %>" required>
                </div>

                <div class="form-group">
                    <label for="slug">Slug *</label>
                    <input type="text" id="slug" name="slug" value="<%= movie?.slug || '' %>" required>
                    <small>URL-friendly identifier (e.g., "the-avengers-2012")</small>
                </div>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="5"><%= movie?.description || '' %></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="thumbnail">Thumbnail URL</label>
                    <input type="url" id="thumbnail" name="thumbnail" value="<%= movie?.thumbnail || '' %>">
                </div>

                <div class="form-group">
                    <label for="screenshot">Screenshot URL</label>
                    <input type="url" id="screenshot" name="screenshot" value="<%= movie?.screenshot || '' %>">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="genre">Genre</label>
                    <input type="text" id="genre" name="genre" value="<%= movie?.genre || '' %>">
                </div>

                <div class="form-group">
                    <label for="languages">Languages</label>
                    <input type="text" id="languages" name="languages" value="<%= movie?.languages || '' %>">
                    <small>Comma-separated (e.g., "English, Hindi")</small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="duration">Duration</label>
                    <input type="text" id="duration" name="duration" value="<%= movie?.duration || '' %>" placeholder="e.g., 2h 30m">
                </div>

                <div class="form-group">
                    <label for="releaseYear">Release Year</label>
                    <input type="number" id="releaseYear" name="releaseYear" value="<%= movie?.releaseYear || '' %>" min="1900" max="<%= new Date().getFullYear() + 5 %>">
                </div>
            </div>

            <div class="form-group">
                <label for="cast">Cast</label>
                <input type="text" id="cast" name="cast" value="<%= movie?.cast || '' %>">
                <small>Comma-separated actor names</small>
            </div>

            <div class="form-group">
                <label for="downloadUrl">Download URL</label>
                <input type="url" id="downloadUrl" name="downloadUrl" value="<%= movie?.downloadUrl || '' %>">
            </div>

            <div class="form-group">
                <label for="sizes">File Sizes</label>
                <input type="text" id="sizes" name="sizes" value="<%= movie?.sizes || '' %>">
                <small>Comma-separated (e.g., "720p, 1080p")</small>
            </div>

            <div class="form-group">
                <label for="keywords">Keywords</label>
                <input type="text" id="keywords" name="keywords" value="<%= movie?.keywords || '' %>">
                <small>Comma-separated keywords for SEO</small>
            </div>

            <div class="form-group">
                <label for="categoryId">Category</label>
                <select id="categoryId" name="categoryId">
                    <option value="">-- Select Category --</option>
                    <% if (categories && categories.length > 0) { %>
                        <% categories.forEach(function(category) { %>
                            <option value="<%= category.id %>" <%= (movie?.categoryId == category.id) ? 'selected' : '' %>><%= category.name %></option>
                        <% }); %>
                    <% } %>
                </select>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Add Movie</button>
                <a href="/admin/movies" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
    // Auto-generate slug from title
    document.getElementById('title')?.addEventListener('input', function(e) {
        const slugInput = document.getElementById('slug');
        if (slugInput && !slugInput.value) {
            const slug = e.target.value
                .toLowerCase()
                .trim()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-');
            slugInput.value = slug;
        }
    });
</script>

<%- include('../../partials/admin_footer') %>

